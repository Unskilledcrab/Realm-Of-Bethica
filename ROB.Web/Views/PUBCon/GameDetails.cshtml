@model ROB.Web.Models.PUBConGameModel
@inject UserManager<ApplicationUser> userManager

@{
    ViewData["Title"] = "Game Details";
}

@section Styles {
    @{await Html.RenderPartialAsync("_PUGConStylesPartial");}
}

<div class="body3 pug-bg"></div>
<div class="container">
    <div class="sans-serif-font1">
        <div class="row pad-top-20">
            <div class="col-12">
                <p class="text-center sans-serif-font2"><strong><span style="text-decoration: underline;">Game Details</span></strong></p>
            </div>
        </div>
        <div class="row justify-content-center align-items-center articles" style="/*margin-top: 200px;*/">
            <div class="col-12 box-border3">
                <div class="row align-items-baseline">
                    <div class="col-1"><img src="assets/img/Ninja_Male_Pog_01.png" style="width: 60px;"></div>
                    <div class="col">
                        <p class="text-left text-indent-25">GM: @Model.GameMaster</p>
                    </div>
                </div>
                <p title="Click to show game details!"><strong>@Model.EventTitle</strong></p>
                <p title="Click to show game details!"><strong>@Model.GameType</strong></p>
                <div class="row">
                    <div class="col-4">
                        <p class="no-margin">When</p>
                        <p class="sans-serif-font1">@Model.EventDate</p>
                        <p class="no-margin">Where</p>
                        <p class="sans-serif-font1">@Model.DiscordChannel</p>
                    </div>
                    <div class="col-5">
                        <p class="text-right no-margin">Run Time</p>
                        <p class="text-right sans-serif-font1">@Model.EventDuration hours</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <p>Reserved</p>
                        @foreach (var player in @Model.Players)
                        {
                            <p class="sans-serif-font1a">@player.User.UserName</p>
                        }
                    </div>
                    <div class="col">
                        <p class="text-right">Links</p>
                        <p class="text-right sans-serif-font1a">www.discord.com</p>
                        <p class="text-right sans-serif-font1a">www.universalbattle.com</p>
                        <p class="text-right sans-serif-font1a">www.ubunlimited.com</p>
                    </div>
                </div>
                <div class="row pad-top-20">
                    <div class="col">
                        <p class="text-break"><span style="text-decoration: underline;">Game Description</span></p>
                        <p class="text-break text-justify sans-serif-font1c">
                            @Model.Description
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col text-center">
                        <div class="row text-left pad-top-20">
                            <div class="col">
                                @{
                                    var userId = userManager.GetUserId(User);
                                    if (Model.CreatorId != userId)
                                    {

                                        bool isSignedUp = false;
                                        foreach (var player in Model.Players)
                                        {
                                            if (player.UserId == userId) isSignedUp = true;
                                        }

                                        var playerCount = Model.Players.Count();
                                        var maxPlayers = Model.MaximumPlayers;
                                        var btnClass = "btn-success";
                                        var btnSignUpText = "Sign Up";
                                        if (playerCount >= (maxPlayers - 2))
                                        {
                                            btnClass = "btn-warning";
                                            btnSignUpText = "Sign Up Quick!";
                                        }
                                        else if (playerCount >= maxPlayers)
                                        {
                                            btnClass = "btn-dark disabled";
                                            btnSignUpText = "Full Party";
                                        }
                                        if (isSignedUp)
                                        {
                                            <a class="btn btn-dark text-left" asp-action="LeaveGame" asp-route-id="@Model.Id">Leave Game</a>
                                        }
                                        else
                                        {
                                            <a class="btn @btnClass text-left" asp-action="JoinGame" asp-route-id="@Model.Id">@btnSignUpText</a>
                                        }
                                    }
                                    else
                                    {
                                        <a class="btn btn-success text-center d-none" asp-action="EditGame" asp-route-id="@Model.Id">Edit Game</a>
                                        <div class="col text-center">
                                            <a class="btn btn-danger text-left" asp-action="DeleteGame" asp-route-id="@Model.Id">Delete Game</a>
                                        </div>
                                    }
                                }
                            </div>
                            <div class="col text-right">
                                <a class="" asp-action="GameDashboard">Event Dashboard</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center box-border2">
        <div class="row justify-content-center align-items-center pad-top-20">
            <div class="col-12">
                <p style="margin-bottom: 0px;">Fantasy Ground Pickup Game VTT Con&nbsp;</p>
                <p style="margin-bottom: 0px;">Sponsered by:</p>
            </div>
            @*<div class="col text-center"><img class="img-fluid" src="~/images/_BStudio/PUGCon/PUG-Logo.png"></div>*@
            <div class="col text-center"><img class="img-fluid" src="~/images/_BStudio/PUGCon/UB_Logo2.png"></div>
            <div class="col text-center"><img class="img-fluid" src="~/images/_BStudio/PUGCon/Bethica_logo_edited_final.png"></div>
            <div class="col text-center"><img class="img-fluid" src="~/images/_BStudio/PUGCon/UB Unlimited-02.png"></div>
        </div>
    </div>
</div>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    @{await Html.RenderPartialAsync("_PUGConScriptPartial");}
}
function addCustomItem(){customItem=$("#customItem").val();html=`<div style="margin-top: 15px;display:none;" class="col-12" id="place`+itemCount+`">
  <div class="col">
  <span>    
    <button id="placeBtn`+itemCount+`" class="btn btn-primary disabled" type="button" >
       `+customItem+` <span class="badge badge-light">`+5+` <i class="fas fa-star"></i></span>
     </button>
     <button class="btn btn-danger" onclick="removeCustomItem('place`+itemCount+`')"><i class="fas fa-trash-alt"></i></button>
   </span>
   </div>
   </div>`;itemCount++;customItemCount++;addToCustomChoices(html,itemCount-1)}function selectRandomItem(){itemCount!=0&&(selectedIndex=Math.floor(Math.random()*itemCount),selectedItem=$("#placeBtn"+selectedIndex),selectedItem.length>0?($("html, body").animate({scrollTop:$("#place"+selectedIndex).offset().top},1500),selectedItem.addClass("btn-success"),selectedItem.removeClass("btn-primary")):selectRandomItem())}function removePlace(n){$("#"+n).remove()}function removeCustomItem(n){$("#"+n).remove();customItemCount--}function getNearbyPlaces(n){var t=new google.maps.LatLng(n.coords.latitude,n.coords.longitude),i={location:t,radius:searchRadius,type:["restaurant"],openNow:!0};service=new google.maps.places.PlacesService(map);service.nearbySearch(i,function(n,t){if(searchCount==0){if(n.length<20){searchCount++;searchRadius="2000";getNearbyPlaces(currentPosition);return}}else if(searchCount==1){if(n.length<20){searchCount++;searchRadius="5000";getNearbyPlaces(currentPosition);return}}else if(searchCount==2){if(n.length<20){searchCount++;searchRadius="10000";getNearbyPlaces(currentPosition);return}}else if(searchCount==3){if(n.length<20){searchCount++;searchRadius="15000";getNearbyPlaces(currentPosition);return}}else if(searchCount==4){if(n.length<20){searchCount++;searchRadius="25000";getNearbyPlaces(currentPosition);return}}else searchCount==5&&n.length<20&&(searchCount++,searchRadius="50000");console.log(n);console.log(t);nextPageToken=n.next_page_token;nextPageToken?$("#findPlaces").text("Add More Places"):$("#findPlaces").text("Refresh List");n.forEach(listPlaces)})}function initMap(){var n={lat:-25.344,lng:131.036},t;map=new google.maps.Map(document.getElementById("map"),{zoom:4,center:n});t=new google.maps.Marker({position:n,map:map})}function listPlaces(n,t){var i,r;console.log("getting details: "+t);i=0;i=300*t;r=itemCount;setTimeout(function(){getPlaceDetails(n.place_id,r)},i);itemCount++}function getPlaceDetails(n,t){var i={placeId:n,fields:["name","rating","opening_hours","photos","price_level","reviews","formatted_phone_number","formatted_address","icon","website","geometry"]};service=new google.maps.places.PlacesService(map);service.getDetails(i,function(n,i){console.log(n);console.log(i);console.log("getting details from API for: "+t);formatPlace(n,t)})}function formatPlace(n,t){console.log("formatting: "+t);var r="";if(r=formatCollapseBegin(n,t),r+=formatIcon(n),r+=formatClosingTime(n),r+=formatPrice(n),r+=formatPhoneNumber(n),r+=formatAddress(n),r+=formatWebsite(n),n.photos){for(r+=formatCarouselBegin(t),i=0;i<n.photos.length;i++)picUrl=n.photos[i].getUrl({maxWidth:300,maxHeight:300}),r+=formatAddPictureToCarousel(picUrl,i);r+=formatCarouselEnd(t)}r+=formatReview(n);r+=formatCollapseEnd(t);addToChoices(r,t)}function formatCollapseBegin(n,t){return`<div style="margin-top: 15px;display:none;" class="col-12" id="place`+t+`">
  <div class="col">
  <span>    
    <button id="placeBtn`+t+`" class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse`+t+`" aria-expanded="false" aria-controls="collapseExample">
       `+n.name+` <span class="badge badge-light">`+n.rating+` <i class="fas fa-star"></i></span>
     </button>
     <button class="btn btn-danger" onclick="removePlace('place`+t+`')"><i class="fas fa-trash-alt"></i></button>
   </span>
   <div class="collapse" id="collapse`+t+`">
     <div class="card card-body">`}function formatIcon(n){return`<img src="`+n.icon+`" class="rounded mx-auto d-block" alt="icon">`}function formatPrice(n){for(price="<span>Price: ",i=0;i<n.price_level;i++)price+=`<i class="fas fa-dollar-sign"></i>`;return price+=`</span>`}function formatClosingTime(n){return n.opening_hours.periods.length==1?`<div class="alert alert-success" role="alert">
    This place is always open 
  </div>`:(currentHour=hour*60,currentTime=currentHour+minute,closingTime=parseInt(n.opening_hours.periods[dayOfWeek].close.time),closingTime==0&&(closingTime=2400),closingHours=Math.floor(closingTime/100),closingMinutesExtra=parseInt(closingTime.toString().substr(closingTime.toString().length-2)),closingTime=closingMinutesExtra+60*closingHours,closingTime<currentTime&&(closingTime+=1440),minutesTillClose=closingTime-currentTime,minutesTillClose<60?`<div class="alert alert-danger" role="alert">
    Closing in `+minutesTillClose+` minutes!!!
  </div>`:(hoursToClose=Math.floor(minutesTillClose/60),minutesToClose=minutesTillClose-60*hoursToClose,`<div class="alert alert-success" role="alert">
    Closing in `+hoursToClose+` hours & `+minutesToClose+` minutes
  </div>`))}function formatPhoneNumber(n){return`<span><i class="fas fa-phone"></i> <a href="tel:`+n.formatted_phone_number+`">`+n.formatted_phone_number+`</a></span>`}function formatAddress(n){return n.geometry?`<span><i class="fas fa-map-marked-alt"></i> <a href="https://maps.google.com/?q=`+n.formatted_address+`">`+n.formatted_address+`</a></span>`:""}function formatWebsite(n){return n.website?`<a href="`+n.website+`">View Website</a>`:""}function formatReview(n){for(author=n.reviews[0].author_name,authorPic=n.reviews[0].profile_photo_url,authorRating=n.reviews[0].rating,authorTimeDesc=n.reviews[0].relative_time_description,authorText=n.reviews[0].text,authorStars=" <span>",i=0;i<5;i++)authorStars+=authorRating>i?`<i class="fas fa-star"></i>`:`<i class="far fa-star"></i>`;return authorStars+=`</span>`,`<div class="card mb-3">
  <div class="row no-gutters">
    <div class="col-md-4">
      <img src="`+authorPic+`" class="rounded mx-auto d-block" alt="author picture">
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title">`+author+`</h5>
        <h5 class="card-title">`+authorStars+`</h5>		
        <p class="card-text">`+authorText+`</p>
        <p class="card-text"><small class="text-muted">`+authorTimeDesc+`</small></p>
      </div>
    </div>
  </div>
</div>`}function formatCarouselBegin(n){return`<div id="carousel`+n+`" class="carousel slide">
    <div class="carousel-inner">`}function formatAddPictureToCarousel(n,t){return active=t==0?" active":"",`<div class="carousel-item`+active+`">
    <img src=`+n+`" class="d-block w-100" alt="picture`+t+`">
  </div>`}function formatCarouselEnd(n){return`</div>
    <a class="carousel-control-prev" href="#carousel`+n+`" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carousel`+n+`" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>`}function formatCollapseEnd(){return`</div>
      </div>
    </div>      
  </div>
  `}function addToChoices(n,t){$("#choices").append(n);fadeInPlace(t)}function addToCustomChoices(n,t){$("#customChoices").append(n);fadeInPlace(t)}function fadeInPlace(n){var t=$("#place"+n);t.css({left:"-100px",opacity:"0"});t.show();t.animate({left:"0px",opacity:"1"},2e3)}var date=new Date,dayOfWeek=date.getDay(),hour=date.getHours(),minute=date.getMinutes(),itemCount=0,customItemCount=0,nextPageToken="",currentPosition,map,searchRadius="1000",searchCount=0;$("#findPlaces").click(function(){if(currentPosition){nextPageToken||($("#choices").empty(),itemCount=0,itemCount=customItemCount);getNearbyPlaces(currentPosition);return}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){currentPosition=n;nextPageToken||($("#choices").empty(),itemCount=0,itemCount=customItemCount);getNearbyPlaces(n)}):console.log("geolocation is not supported")});